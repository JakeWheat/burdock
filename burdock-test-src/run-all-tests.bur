
#|

read all bur and rst files in built-ins
burdock test src except this one
docs
examples
packages/ffitypes-test
website2

|#

import _internals as _internals

include filesystem
import from lists:
  map,
  filter,
  not-elem
end

include testing

fun my-ld(dir):
  glob(dir + "**/*.bur") + glob(dir + "**/*.rst")
end

srcs = (my-ld("built-ins")
       ^ filter(not-elem(_,[list:"./built-ins/_internals.bur", "./built-ins/globals.bur"]), _))
       + (my-ld("burdock-test-src")
       ^ filter(not-elem(_,[list:"./burdock-test-src/run-all-tests.bur",
                            "./burdock-test-src/run-all-tests-additional.bur"]), _))
       + my-ld("docs")
       + my-ld("website2")


ts = run-tests-with-opts(default-test-opts.{test-sources:map(file-test(_), srcs),
                                       show-progress-log:true,
                                       auto-print-results:true,
                                       hide-successes:true
                                      })

when has-test-failures(ts):
  _internals.sysexit(1)
end
