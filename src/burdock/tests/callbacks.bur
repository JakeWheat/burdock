
include haskell("test-helpers")

# these two tests show that it looks simple to determine if a callback
# from haskell to burdock is being run from a "sychronous" call to haskell,
# or if the callback is being run from another haskell thread

check "thread id in haskell callback":

  tid = my-thread-id()

  var log = empty

  fun logit():
    log := link(my-thread-id(), log)
  end

  run-callback-n(5, logit)

  log is repeat(5, tid)

end

check "thread id in haskell async callback":

  tid = my-thread-id()

  var log = empty

  fun logit():
    log := link(my-thread-id(), log)
  end

  reps = 5

  h = run-callback-async-n(reps, 0.05, logit)

  test-wait(h)

  tid1 = handle-thread-id(h)
  tid is-not tid1

  log is repeat(reps, tid1)

end
